{% extends "base.html" %}

{% block body %}


{% include "messages.html" %}

{% if form %}
    <form class="form-inline" role="form" method="GET" action="{{ url_for("changes_merged") }}">
        {# {{ form.hidden_tag() }}  #}
        <div class="form-group">
            <label class="sr-only" for="title">Author</label>
            <input type="text" class="form-control" name="title" id="title" value="{{ request.args.get('title', "") }}" placeholder="{{form.title.description}}">
        </div>
        <div class="form-group">
            <label class="sr-only" for="author">Author</label>
            <input type="text" class="form-control" name="author" id="author" value="{{ request.args.get('author', "") }}" placeholder="{{form.author.description}}">
        </div>
        <button type="submit" class="btn btn-default">Filter</button>
    </form>
{% endif %}


<h1>Merged changes</h1>

    <table class="table table-hover">
        <thead>
        <tr>
            <th>No.</th>
            <th>Changeset</th>
            <th>Author</th>
            <th>Merged</th>
            <th>Bookmark</th>
            <th>Target Branch</th>
            <th>Status</th>
        </tr>
        </thead>
        <tbody>

        {% for r in reviews %}
            <tr>
                <td>{{ pagination.start_index + loop.index - 1 }}</td>
                <td>
                    <a href="{{ url_for("review_info", review_id=r.id) }}">{{ r.title }} </a>
                </td>
                <td>{{ r.owner }}</td>
                <td>{{ r.close_date }}</td>
                <td>{{ r.bookmark }}</td>
                <td>{{ r.target }}</td>
                <td>
                    {% if r.changesets|length > 0 and r.changesets[-1].builds|length > 0 %}
                        {% if r.changesets[-1].builds[-1].status == "Running" %}
                            <span class="label label-info">{{ r.changesets[-1].builds[-1].status }}</span>
                        {% elif r.changesets[-1].builds[-1].status == "SUCCESS" %}
                            <span class="label label-success">{{ r.changesets[-1].builds[-1].status }}</span>
                        {% elif r.changesets[-1].builds[-1].status == "UNSTABLE" %}
                            <span class="label label-warning">{{ r.changesets[-1].builds[-1].status }}</span>
                        {% elif r.changesets[-1].builds[-1].status == "FAILURE" %}
                            <span class="label label-danger">{{ r.changesets[-1].builds[-1].status }}</span>
                        {% else %}
                            <span class="label label-default">{{ r.changesets[-1].builds[-1].status }}</span>
                        {% endif %}
                    {% else %}
                        <span class="label label-default">None</span>
                    {% endif %}
                    <br/>
                    {% if review.inspection == None %}
                        <span class="label label-default">None</span>
                    {% elif review.inspection.status == "Completed" %}
                        <span class="label label-success">{{ review.inspection.status }}</span>
                    {% elif review.inspection.status == "SCHEDULED" or review.inspection.status == "NEW" %}
                        <span class="label label-default">{{ review.inspection.status }}</span>
                    {% else %}
                        <span class="label label-warning">{{ review.inspection.status }}</span>
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        </tr>
        </tbody>
    </table>

    {% from "_helpers.html" import render_pagination %}
    {{ render_pagination(pagination) }}



{% endblock %}